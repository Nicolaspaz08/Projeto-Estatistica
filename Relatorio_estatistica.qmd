---
title: "Relatorio Final de Estatística - Energias Renováveis"
author: "Nicole Brito Maracajá / Nicolas Wesley Correia Paz"
format: html
editor: visual
---

# 1. Introdução

O presente relatório tem por objetivo a análise estatística de uma base de dados referente à produção de energia em diferentes tipos de usinas de geração de energia renovável, com 1000 observações e 11 variáveis:

-   **Produção_energia_MWh_ano**: Energia elétrica total gerada pelo sistema no último ano (MWh/ano). Variável dependente.

-   **Capacidade_instalada_MW**: Capacidade nominal instalada do projeto (MW).

-   **Investimento_R\$mi**: Investimento total realizado no projeto (milhões de reais).

-   **Fator_capacidade_pct**: Fator de capacidade técnico (%), combinando disponibilidade de recurso e desempenho do sistema.

-   **Disponibilidade_pct**: Percentual de tempo em que o sistema ficou operacional durante o ano (%).

-   **Irradiancia_kWh_m2_dia**: Irradiância média diária (kWh/m²/dia), mais relevante para usinas solares.

-   **Vento_m_s**: Velocidade média do vento a 100 m (m/s), mais relevante para usinas eólicas.

-   **Distancia_rede_km**: Distância até o ponto de conexão à rede elétrica (km), podendo impactar perdas.

-   **Idade_projeto_anos**: Idade do projeto desde a entrada em operação comercial (anos).

-   **Tecnologia**: Tipo tecnológico do projeto (“Solar”, “Eólica”, “PCH”, “Biomassa”).

-   **Rastreador_solar**: Uso de rastreador no arranjo solar: “Sim” ou “Não” (aplicável principalmente a usinas solares).

# 2. Preparação

Carregando os pacotes necessários e funções para formatar tabelas e gráficos.

```{r}
library(readr)
library(dplyr)
library(skimr)
library(corrplot)
library(ggplot2)
library(report)
library(gtsummary)
library(easystats) 
library(kableExtra)
library(readxl)

# Pode ser necessário instalar alguns pacotes se ainda não tiver na sua sessão:
# install.packages("readr")
# install.packages("dplyr")
# install.packages("skimr")
# install.packages("corrplot")
# install.packages("ggplot2")
# install.packages("report")
# install.packages("gtsummary")
# install.packages("easystats")
# install.packages("flextable")
# install.packages("kableExtra")
# install.packages("readxl")
```

## 2.1. Os Dados

Os dados foram carregados a partir do arquivo `energia_renovavel.xlsx`. Uma inspeção inicial é realizada para verificar a estrutura e o conteúdo das variáveis.

```{r}
dataset <- read_excel("energia_renovavel.xlsx")
kable(head(dataset, 10), format = "latex", booktabs = TRUE) %>%
kable_styling(latex_options = c("scale_down", "HOLD_position"))
head(dataset)
```

# 3. Análise Exploratória

Nesta seção, realizamos uma investigação inicial sobre os dados para identificar padrões, anomalias, e relações entre as variáveis, o que guiará a etapa de modelagem.

## 3.1. Sumário Estatístico e Valores Ausentes

```{r}
dataset_limpo <- dataset[complete.cases(dataset), ]

cat("Número de linhas original:", nrow(dataset), "\n")
cat("Número de linhas após remover NAs:", nrow(dataset_limpo), "\n")
```

Para garantir a integridade e a precisão das análises subsequentes, foi realizado um tratamento dos valores ausentes (`NA`) presentes na base de dados. O conjunto de dados original continha um total de 1000 observações.

Após a aplicação de um procedimento para remover todas as linhas que continham ao menos um valor ausente, o conjunto de dados foi reduzido para **916 observações completas**. Isso resultou na exclusão de 84 linhas, o que corresponde a **8,4%** do total de dados.

Essa etapa de limpeza é fundamental para evitar que os valores ausentes causem erros ou vieses na construção do modelo de regressão. Todas as análises a seguir serão realizadas utilizando este novo conjunto de dados, mais robusto e livre de valores faltantes.

```{r}
dados <- dataset_limpo %>%
  filter(
    `capacidade_instalada_MW` >= 0,
    `investimento_R$mi` >= 0,
    `disponibilidade_pct` >= 0,
    `distancia_rede_km` >= 0
  )

cat("Linhas no dataset antes da correção de erros:", nrow(dataset_limpo), "\n")
cat("Linhas no dataset final corrigido:", nrow(dados), "\n")
```

Em seguida, durante a análise exploratória de valores ausentes, foi identificada a presença de **valores negativos** em variáveis que, por sua natureza, não podem ser negativas, como `capacidade_instalada_MW`, `investimento_R$mi`, `disponibilidade_pct` e `distancia_rede_km`. Esses valores são considerados erros de registro ou artefatos da simulação dos dados e precisam ser removidos para não distorcer o modelo.

Portanto, uma segunda filtragem foi aplicada para excluir todas as linhas que continham esses valores fisicamente impossíveis. Após esta correção, o conjunto de dados final, que será utilizado em todas as análises futuras, ficou com 897 observações completas e válidas.

Essa limpeza em duas etapas é um passo crucial para assegurar que o modelo de regressão seja construído sobre uma base de dados robusta e confiável. Agora, temos a nossa base de dados limpa e livre de anomalias. Podemos visualizá-la abaixo:

```{r}
View(dados)
```

## 3.2. Análise de Outliers

Outliers são valores **atípicos** que podem influenciar o modelo de regressão. Para identificá-los, geramos boxplots para cada variável numérica. É importante notar que a presença de um outlier não implica necessariamente em um erro; ele pode representar uma observação legítima e valiosa (ex: um projeto de altíssimo investimento). Conforme as boas práticas, a remoção de outliers só é recomendada quando há certeza de que o dado é um erro de registro. Portanto, nesta análise, os outliers serão **identificados, mas não removidos**, e sua possível influência será avaliada nos diagnósticos do modelo final.

O objetivo desta etapa é identificar visualmente (com boxplots) e numericamente os valores que se distanciam significativamente da maioria das observações para cada variável.

```{r}
# Define a função para mostrar o boxplot e listar os outliers
mostrar_outliers <- function(dataframe, nome_da_coluna) {
  
  dados_da_coluna <- dataframe[[nome_da_coluna]]
  
  # Gera o gráfico de boxplot
  boxplot(dados_da_coluna, 
          main = paste("Boxplot de", gsub("_", " ", nome_da_coluna)), 
          ylab = "Valores",
          col = "#87CEEB")
  
  # Extrai os valores dos outliers
  outliers <- boxplot.stats(dados_da_coluna)$out
  
  if (length(outliers) > 0) {
    cat(paste("Outliers encontrados na variável '", nome_da_coluna, "':\n", sep = ""))
    print(outliers)
  } else {
    cat(paste("Nenhum outlier encontrado na variável '", nome_da_coluna, "'.\n", sep = ""))
  }
  
  cat("\n---\n")
}

# Obtém a lista de todas as variáveis númericas do dataset limpo
variaveis_numericas <- dados %>% 
  select_if(is.numeric) %>% 
  names()

for (variavel in variaveis_numericas) {
  mostrar_outliers(dados, variavel)
}
```

A análise dos boxplots e a listagem numérica dos outliers do conjunto de dados já corrigido (`dados`) confirmam a presença de valores extremos, porém fisicamente plausíveis.

Variáveis como `investimento_R$mi` e `fator_capacidade_pct` apresentam outliers que correspondem aos projetos de maior escala ou com desempenho excepcional dentro da amostra. É notável que, após a remoção dos dados errôneos, variáveis-chave como `Produção_energia_MWh_ano` e `capacidade_instalada_MW` não apresentam mais outliers estatísticos, indicando uma distribuição mais homogênea para a maioria dos projetos.

Esses pontos extremos válidos são informativos e essenciais para a análise. Portanto, **serão mantidos** para garantir que o modelo de regressão represente toda a variabilidade dos dados, conforme as boas práticas estatísticas.

## 3.3. Variáveis Qualitativas

Diferente das variáveis quantitativas (que são números, como `investimento_R$mi`), as **variáveis qualitativas (ou categóricas)** representam grupos, rótulos ou qualidades. Em vez de calcular uma média, nós analisamos a frequência com que cada categoria aparece para entender a composição dos nossos dados.

Em nosso conjunto de dados, as duas variáveis qualitativas que utilizamos são:

1.  **`tecnologia`**: Descreve o tipo de usina, com as categorias "Solar", "Eólica", "PCH" e "Biomassa".

2.  **`rastreador_solar`**: Indica se o projeto utiliza ou não esta tecnologia de otimização, com as categorias "Sim" e "Não".

Os gráficos de barras a seguir nos permitem visualizar a distribuição das usinas entre essas categorias. A análise mostra que:

-   **Tecnologia:** Observa-se uma predominância das usinas Solar e Eólica, que juntas representam a maior parte da base. Já as tecnologias Biomassa e PCH possuem participação bem menor. Esse desbalanceamento deve ser considerado na modelagem, pois tecnologias com poucas observações (como PCH) podem ter efeito estatístico menos confiável.

-   **Rastreador Solar:** A grande maioria dos projetos não utiliza rastreador solar. Este resultado é esperado, uma vez que essa característica é primariamente aplicável às usinas de tecnologia Solar. Para as demais (Eólica, Biomassa, PCH), a categoria é naturalmente "Não".

Essa análise confirma a composição da nossa amostra e nos prepara para a próxima etapa, onde investigaremos como as variáveis numéricas se relacionam entre si.

```{r}

library(ggplot2)

# Distribuição de Usinas por Tecnologia
ggplot(dados, aes(x = tecnologia, fill = tecnologia)) +
  geom_bar() +
  labs(
    title = "Distribuição de Usinas por Tecnologia",
    x = "Tecnologia",
    y = "Frequência (Nº de Usinas)"
  ) +
  theme_minimal() +
  theme(legend.position = "none") 


# Distribuição por Uso de Rastreador Solar
ggplot(dados, aes(x = rastreador_solar, fill = rastreador_solar)) +
  geom_bar() +
  labs(
    title = "Distribuição por Uso de Rastreador Solar",
    x = "Uso de Rastreador",
    y = "Frequência (Nº de Usinas)"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

A análise das variáveis qualitativas `tecnologia` e `rastreador_solar` revela a composição detalhada da amostra. Observa-se uma clara predominância das tecnologias **Solar** e **Eólica**, que juntas representam a maior parte dos projetos, em detrimento de **PCH** e **Biomassa**, que possuem uma representatividade mais modesta. Em paralelo, a análise de `rastreador_solar` mostra que a maioria das usinas se enquadra na categoria "Não", um resultado consistente com o fato de que esta tecnologia é específica para usinas Solares, a categoria mais numerosa da amostra. Essa distribuição desigual é um ponto de atenção para a etapa de modelagem, pois o modelo terá uma base de dados mais robusta para as tecnologias predominantes.

Ao final desta Análise Exploratória, temos uma compreensão clara do nosso conjunto de dados corrigido. Identificamos a distribuição das usinas por `tecnologia`, a presença de outliers válidos que representam projetos de grande escala e, mais importante, a forte multicolinearidade entre `investimento_R$mi` e `capacidade_instalada_MW`. Essas informações são essenciais e guiarão diretamente a próxima etapa: a construção e seleção de um modelo de regressão linear robusto.

## 3.4. Análise das Variáveis

Nesta seção, investigamos as relações entre as variáveis numéricas de duas formas complementares. Primeiro, através de uma matriz de correlação para quantificar a força da relação linear entre todos os pares de variáveis. Segundo, com gráficos de dispersão para visualizar a natureza da relação entre a variável resposta e os preditores mais importantes.

### 3.4.1. Correlação das Variáveis:

A matriz de correlação, visualizada como um mapa de calor, nos permite identificar rapidamente quais variáveis estão mais associadas com a `Produção_energia_MWh_ano` e, fundamentalmente, detectar possíveis casos de multicolinearidade (alta correlação entre variáveis preditoras).

```{r}
library(ggcorrplot)

# Seleciona apenas as variáveis numéricas dos dados
dados_numericos <- dados %>% 
  select_if(is.numeric)

# Calcula a matriz de correlação
matriz_cor <- cor(dados_numericos)

# Plota o mapa de calor de correlação
ggcorrplot(matriz_cor,
           method = "square",
           type = "lower",
           lab = TRUE, # Mostra os coeficientes
           lab_size = 3,
           colors = c("#6D9EC1", "white", "#E46726"),
           title = "Mapa de Calor das Correlações")

print(sort(matriz_cor[,"Produção_energia_MWh_ano"], decreasing = TRUE))

```

A análise da matriz de correlação revela pontos cruciais e surpreendentes sobre os dados:

1.  **Relação Perfeita:** O resultado mais impactante é a correlação **perfeita (1.00)** entre `Produção_energia_MWh_ano` e `capacidade_instalada_MW`. Isso indica que, neste conjunto de dados, a capacidade instalada sozinha consegue prever a produção de energia quase que perfeitamente. Uma correlação tão alta é incomum em dados do mundo real e sugere que, na simulação que gerou estes dados, a produção pode ter sido calculada diretamente a partir da capacidade, tornando-a a variável preditora dominante.

2.  **Multicolinearidade Confirmada:** Confirma-se também a **altíssima correlação (0.95)** entre `capacidade_instalada_MW` e `investimento_R$mi`. Isso reforça a necessidade absoluta de remover uma dessas duas variáveis do modelo de regressão para evitar o problema da multicolinearidade.

3.  **Correlações Fracas e Contra-intuitivas:** Curiosamente, a maioria das outras variáveis mostra uma correlação muito fraca com a produção de energia. A correlação com o `fator_capacidade_pct` é **fraca e negativa (-0.15)**, o que é contra-intuitivo (esperaríamos que uma maior eficiência levasse a uma maior produção). Isso pode ser um sinal de que o efeito dominante da `capacidade_instalada_MW` está mascarando a verdadeira relação das outras variáveis, algo que a análise de regressão múltipla ajudará a esclarecer.

4.  **Preditores de Baixo Impacto:** As demais variáveis, como `disponibilidade_pct`, `distancia_rede_km` e `idade_projeto_anos`, mostram correlações muito próximas de zero, sugerindo que elas têm pouco poder preditivo linear sobre a produção de energia.

Além dessas informações, também podemos observar uma correlação moderada (0.46) entre vento_m_s e irradiancia_kWh_m2_dia, o que é intuitivo, pois regiões com maior incidência solar também podem ter padrões de vento mais consistentes. Além disso, existe uma correlação negativa forte (−0.55) entre irradiância e fator de capacidade, o que merece investigação, já que, em princípio, esperaríamos uma relação positiva. Para fins de modelagem, é importante considerar que variáveis altamente correlacionadas podem introduzir multicolinearidade, sendo necessário avaliar sua inclusão conjunta no modelo.

### 3.4.2. Dispersão

Para visualizar a forma da relação entre os preditores mais promissores e a produção de energia, geramos gráficos de dispersão. A linha de tendência (em vermelho) ajuda a confirmar a direção da relação linear.

```{r}
# Lista dos preditores mais importantes para visualizar
preditores_principais <- c("capacidade_instalada_MW", "investimento_R$mi", 
                           "fator_capacidade_pct", "disponibilidade_pct")

# Loop para criar um gráfico de dispersão para cada preditor principal
for (variavel in preditores_principais) {
  
  p <- ggplot(dados, aes(x = .data[[variavel]], y = `Produção_energia_MWh_ano`)) +
    geom_point(alpha = 0.5, color = "steelblue") +
    geom_smooth(method = "lm", se = FALSE, color = "red3") +
    labs(
      title = paste("Dispersão: Produção de Energia vs", gsub("_", " ", variavel)),
      x = gsub("_", " ", variavel),
      y = "Produção de Energia (MWh/ano)"
    ) +
    theme_minimal()
  
  print(p)
}
```

### 3.4.3. Análise dos Gráficos:

-   Os gráficos de dispersão permitem uma análise visual detalhada da relação entre a produção de energia e os principais preditores numéricos, confirmando as conclusões da análise de correlação:

    1.  **vs. `capacidade_instalada_MW`:** O gráfico revela uma relação linear **quase perfeita**. Os pontos formam uma linha reta extremamente coesa, o que ilustra visualmente a correlação de 1.00. Fica claro que esta é a variável preditora mais dominante.

    2.  **vs. `investimento_R$mi`:** A relação aqui também é **forte e positiva**. No entanto, a dispersão dos pontos ao redor da linha de tendência é visivelmente maior em comparação com a capacidade instalada, o que é consistente com a correlação um pouco menor (0.95).

    3.  **vs. `fator_capacidade_pct` e `disponibilidade_pct`:** Em total contraste, os gráficos para estas duas variáveis mostram nuvens de pontos amplamente dispersas, sem um padrão linear claro. A linha de tendência para `fator_capacidade_pct` tem uma leve inclinação negativa, e a de `disponibilidade_pct` é praticamente horizontal, confirmando a correlação fraca ou inexistente.

    Essas visualizações reforçam que `capacidade_instalada_MW` e `investimento_R$mi` são os únicos preditores com uma forte relação linear com a produção de energia.

# 4. Análise de Regressão

Após a análise exploratória, iniciamos a construção de um modelo de regressão linear múltipla para prever a `Produção_energia_MWh_ano`. O primeiro e mais importante passo desta etapa é abordar a forte multicolinearidade entre `capacidade_instalada_MW` e `investimento_R$mi`, que foi claramente identificada na análise de correlação.

## 4.1. Diagnóstico Formal da Multicolinearidade (VIF)

Para confirmar e quantificar o problema da multicolinearidade, ajustamos um modelo inicial com todas as variáveis preditoras e calculamos o Fator de Inflação da Variância (VIF). Valores de VIF acima de 5 ou 10 são geralmente considerados problemáticos, pois indicam que uma variável preditora pode ser explicada pelas outras.

```{r}
library(performance)

modelo_completo <- lm(`Produção_energia_MWh_ano` ~ ., data = dados)

checa_colinearidade <- check_collinearity(modelo_completo)

print(checa_colinearidade)
```

A análise de multicolinearidade, realizada através da função `check_collinearity()`, nos permite quantificar a redundância entre as variáveis preditoras usando o Fator de Inflação da Variância (VIF). A tabela de resultados confirma e aprofunda nossas suspeitas da análise de correlação:

1.  **Multicolinearidade Confirmada:** As variáveis `capacidade_instalada_MW` (VIF = 18.34) e `investimento_R$mi` (VIF = 19.31) apresentam alta multicolinearidade, como indicado pelos valores de VIF bem acima do limiar de 10. Isso reforça a conclusão de que elas são redundantes e uma delas deve ser removida do modelo.

2.  **Novos Achados Importantes:** A análise revela um problema de colinearidade ainda mais severo com a variável `tecnologia` **(VIF = 143.10)** e também com `fator_capacidade_pct` (VIF = 19.11).

**Por que `tecnologia` tem um VIF tão alto?** É importante notar que a análise de VIF inicial também apontou um valor elevado para a variável `tecnologia`. No entanto, a natureza desta multicolinearidade é fundamentalmente distinta daquela observada entre `capacidade_instalada_MW` e `investimento_R$mi`. Enquanto o par capacidade/investimento apresenta **redundância direta** (ambas medem o mesmo conceito de "escala do projeto"), o VIF elevado de `tecnologia` deriva de uma **associação estrutural**.

Isso significa que suas categorias estão naturalmente correlacionadas com os valores de outros preditores; por exemplo, é esperado que usinas do tipo "Solar" estejam em locais com alta `irradiancia_kWh_m2_dia`, enquanto usinas "Eólicas" estarão em locais com alto `vento_m_s`. Como a variável `tecnologia` é de importância teórica central para o estudo, removê-la nos impediria de analisar o efeito dos diferentes tipos de usina. Portanto, a estratégia metodológica correta é focar na remoção da variável puramente redundante (`investimento_R$mi`). Ao resolver a redundância principal, como será verificado nos diagnósticos do modelo final, os VIFs das demais variáveis se reduzem a níveis perfeitamente aceitáveis.

## **4.2. Tratamento da Multicolinearidade e Seleção do Melhor Modelo**

### 4.2.1. Comparação por Métricas

Com base no diagnóstico de VIF, que apontou uma forte multicolinearidade entre `capacidade_instalada_MW` e `investimento_R$mi`, a etapa seguinte é remover uma dessas variáveis para criar um modelo mais estável e interpretável. Para tomar a decisão de qual variável manter, seguimos a abordagem metodológica correta: criamos dois modelos concorrentes e os comparamos diretamente com base em métricas de ajuste e parcimônia."

Os critérios para a escolha do melhor modelo são:

-   **Maior R² Ajustado:** Indica melhor poder de explicação.

-   **Menores AIC e BIC:** Indicam um melhor equilíbrio entre o ajuste do modelo e sua complexidade.

    ```{r}
    # Modelo 1: Mantém 'capacidade_instalada_MW', remove 'investimento_R$mi'
    modelo_sem_investimento <- lm(`Produção_energia_MWh_ano` ~ . -`investimento_R$mi`, data = dados)

    # Modelo 2: Mantém 'investimento_R$mi', remove 'capacidade_instalada_MW'
    modelo_sem_capacidade <- lm(`Produção_energia_MWh_ano` ~ . -`capacidade_instalada_MW`, data = dados)

    # Criando a tabela para comparar as métricas dos dois modelos
    comparacao_modelos <- data.frame(
      Modelo = c("Sem Investimento (Mantém Capacidade)", "Sem Capacidade (Mantém Investimento)"),
      R2_Ajustado = c(summary(modelo_sem_investimento)$adj.r.squared, summary(modelo_sem_capacidade)$adj.r.squared),
      AIC = c(AIC(modelo_sem_investimento), AIC(modelo_sem_capacidade)),
      BIC = c(BIC(modelo_sem_investimento), BIC(modelo_sem_capacidade))
    )

    # Exibindo a tabela de comparação de forma clara
    library(kableExtra)
    kable(comparacao_modelos, digits = 2, caption = "Comparação de Métricas entre Modelos para Tratar Multicolinearidade") %>%
      kable_styling(bootstrap_options = "striped", full_width = FALSE)
    ```

O `modelo_sem_investimento` (que mantém a variável `capacidade_instalada_MW`) é superior em todos os critérios. Ele apresenta um **R² Ajustado de 1.00**, indicando que o modelo explica praticamente 100% da variabilidade da produção de energia, um valor muito superior aos 0.95 do modelo concorrente.

Adicionalmente, seus valores de **AIC (17495.13)** e **BIC (17557.52)** são drasticamente menores do que os do `modelo_sem_capacidade`, o que aponta para um melhor ajuste e maior parcimônia.

Portanto, a escolha é clara: o `modelo_sem_investimento` é estatisticamente superior em todos os aspectos e será selecionado como nosso `modelo_final` para as próximas etapas da análise.

```{r}
modelo_final <- modelo_sem_investimento
```

### 4.2.2. Teste de Hipótese para Comparação de Modelos (ANOVA)

Além da comparação por métricas como AIC e BIC, utilizamos um teste de hipóteses formal, a Análise de Variância (ANOVA), para verificar se a inclusão da variável `investimento_R$mi` melhora o modelo de forma estatisticamente significativa em relação ao modelo que já contém `capacidade_instalada_MW`.

Para este teste, temos os seguintes modelos aninhados:

-   **Modelo Simples:** O `modelo_final` (sem `investimento_R$mi`).

-   **Modelo Complexo:** O `modelo_completo` (com todas as variáveis).

As hipóteses testadas são:

-   **H₀ (Hipótese Nula):** O modelo simples é suficiente. A adição de `investimento_R$mi` não melhora significativamente o ajuste do modelo.

-   **H₁ (Hipótese Alternativa):** O modelo complexo é significativamente melhor.

A decisão será baseada no p-valor (`Pr(>F)`): se for maior que 0.05, não rejeitamos a H₀ e ficamos com o modelo mais simples, pelo princípio da parcimônia.

```{r}
modelo_completo <- lm(`Produção_energia_MWh_ano` ~ ., data = dados)
modelo_final <- lm(`Produção_energia_MWh_ano` ~ . -`investimento_R$mi`, data = dados)

# Realizando o teste ANOVA para comparar os dois modelos
teste_anova <- anova(modelo_final, modelo_completo)

print(teste_anova)
```

Como verificação adicional para a seleção do modelo, foi realizado um teste de Análise de Variância (ANOVA) para comparar formalmente o `modelo_final` (simples) com o `modelo_completo`. O teste resultou em um p-valor estatisticamente significativo (p \< 0.001), o que, isoladamente, sugeriria que o modelo mais complexo possui um ajuste superior.

No entanto, em cenários de multicolinearidade severa como o identificado, este resultado deve ser interpretado com cautela. A significância estatística detectada reflete uma melhoria marginal no ajuste, de pouca relevância prática, causada pela mínima informação adicional que a variável redundante (`investimento_R$mi`) oferece.

Portanto, priorizando a estabilidade dos coeficientes, a interpretabilidade e o princípio da parcimônia (preferir o modelo mais simples e robusto), a decisão baseada na análise de VIF, AIC e BIC foi mantida. O teste ANOVA, neste contexto, reforça a complexidade da relação entre as variáveis, mas não altera a escolha do `modelo_final` como o mais adequado.

## **4.3. Apresentação do Modelo Final**

Após o processo de seleção que resolveu a multicolinearidade, o `modelo_final` foi definido. A tabela abaixo apresenta os coeficientes, os intervalos de confiança e a significância estatística de cada variável preditora para explicar a `Produção_energia_MWh_ano`.

```{r}
library(gtsummary)

tbl_regression(modelo_final, intercept = TRUE) %>%
  as_kable_extra(caption = "Resultados do Modelo de Regressão Final Selecionado")
```

A tabela de resultados do `modelo_final` nos permite quantificar o efeito de cada variável na produção de energia, enquanto controlamos pelos efeitos de todas as outras. A análise revela os seguintes pontos principais:

1.  **O Fator Dominante (`capacidade_instalada_MW`):** O resultado mais claro e estatisticamente significativo é o da `capacidade_instalada_MW`. O coeficiente (Beta = 2,553) indica que, para cada 1 MW de aumento na capacidade instalada, a produção de energia aumenta em média 2,553 MWh/ano (com p-valor \< 0.001). A força e a precisão deste efeito confirmam que o tamanho do projeto é, de longe, o preditor mais importante.

2.  **Fatores Secundários, mas Significativos:** Além da capacidade, outras duas variáveis mostraram um efeito estatisticamente significativo:

    -   **`distancia_rede_km`**: Possui um impacto negativo e significativo (Beta = -25, p-valor = 0.001). Isso sugere que, a cada quilômetro a mais de distância da rede elétrica, a produção de energia registrada diminui em média 25 MWh/ano, o que pode ser interpretado como perdas de transmissão.

    -   **`rastreador_solar`**: O uso de um rastreador ('Sim') tem um impacto positivo e significativo (Beta = 1,355, p-valor = 0.003), aumentando a produção em média 1,355 MWh/ano em comparação com projetos que não o utilizam ('Não'), mantendo os outros fatores constantes.

3.  **Variáveis Não Significativas (Um Achado Importante):** Um dos pontos mais interessantes de um modelo de regressão múltipla é descobrir quais variáveis *não* são significativas após o ajuste. Neste modelo, variáveis como `fator_capacidade_pct`, a `tecnologia` específica (e.g., Eólica vs. Biomassa), `idade_projeto_anos` e as condições climáticas (`irradiancia` e `vento`) não apresentaram um efeito estatisticamente significativo (todos com p-valores \> 0.05). Isso sugere que a maior parte da variação na produção de energia já é explicada pelo tamanho do projeto, pela distância e pelo uso de rastreadores.

    Dessa forma, o modelo sugere que a produção de energia é esmagadoramente determinada pelo tamanho do projeto (`capacidade_instalada_MW`), com contribuições secundárias, porém significativas e lógicas, da distância à rede e da otimização com rastreadores solares.

    ## **4.4. Interpretação do Modelo Final**

    Na seleção entre as variáveis multicolineares `capacidade_instalada_MW` e `investimento_R$mi`, seguiu-se o critério de manter a variável com maior poder preditivo individual. A `capacidade_instalada_MW` apresentou uma correlação de 1.00 com a produção de energia, superior à do `investimento_R$mi` (0.95), sendo, portanto, a variável escolhida para permanecer no modelo. Embora um teste ANOVA tenha indicado que a inclusão de ambas as variáveis fornecia uma melhoria estatisticamente significativa (p \< 0.001), optou-se pelo modelo mais parcimonioso e estável para evitar os problemas de interpretação causados pela multicolinearidade severa, uma decisão reforçada pelos critérios de AIC e BIC.

# **5.** Verificação dos Pressupostos do Modelo Final

Após a seleção e interpretação do `modelo_final`, a última etapa da modelagem é a análise de diagnóstico. O objetivo é verificar se o modelo atende aos pressupostos do Modelo de Regressão Linear Múltipla (MRLM) para garantir que nossas conclusões são estatisticamente válidas.

## **5.1. Análise Consolidada com `check_model`**

A função `check_model()` oferece um painel visual completo da saúde do nosso modelo, avaliando simultaneamente os principais pressupostos.

```{r}
library(easystats)

check_model(modelo_final)
```

Dados os resultados, temos que o `modelo_final` é robusto e atende a todos os principais pressupostos da Regressão Linear Múltipla:

-   **Linearidade e Homogeneidade da Variância:** Os gráficos de resíduos ("Linearity" e "Homogeneity of Variance") mostram que os pontos se distribuem de forma aleatória e sem padrões evidentes em torno da linha horizontal. A dispersão é constante, indicando que a relação é linear e a variância dos erros é homogênea.

-   **Normalidade dos Resíduos:** O gráfico Q-Q ("Normality of Residuals") demonstra que os resíduos seguem de perto a distribuição normal, com os pontos alinhados quase perfeitamente à linha teórica. Isso valida o uso dos p-valores e intervalos de confiança do modelo.

-   **Colinearidade:** A verificação de colinearidade (VIF) confirma visualmente que todos os preditores restantes possuem um VIF baixo (indicado pela cor verde, \< 5). Isso prova que nossa decisão de remover a variável `investimento_R$mi` foi eficaz para resolver o problema da multicolinearidade.

-   **Observações Influentes:** O gráfico de "Influential Observations" mostra que não há pontos de dados exercendo uma influência desproporcional sobre os coeficientes do modelo, garantindo a estabilidade dos resultados.

-   **Ajuste Geral do Modelo:** O gráfico de "Posterior Predictive Check" mostra que a distribuição dos dados previstos pelo modelo (linha verde) se alinha quase perfeitamente com a distribuição dos dados reais (linha azul), indicando um excelente ajuste geral do modelo à realidade dos dados.

    ## **6.2.** Análise Detalhada com a Função `plot()`

    Para aprofundar a análise, inspecionamos os quatro gráficos de diagnóstico padrão gerados pela função `plot()`, que nos permitem avaliar cada pressuposto fundamental de forma individual.

    ```{r}
    plot(modelo_final)
    ```

**Analisando cada gráfico, temos:**

-   **Gráfico 1: `Residuals vs Fitted` (Linearidade):** Ótimo. Uma nuvem de pontos totalmente aleatória, sem padrões. A linearidade está confirmada.

-   **Gráfico 2: `Normal Q-Q` (Normalidade dos Resíduos):** Excelente. Os pontos estão quase perfeitamente alinhados com a linha, o que é um resultado ideal e confirma a normalidade dos resíduos.

-   **Gráfico 3: `Scale-Location` (Homocedasticidade):** Perfeito. Nenhuma forma de "funil", os pontos estão bem espalhados, confirmando que a variância dos erros é constante.

-   **Gráfico 4: `Residuals vs Leverage` (Observações Influentes):** Nenhum ponto de dados está perto das linhas de Distância de Cook, então não há observações indevidamente influentes.

# 6. Predições para a variável resposta

Com o modelo final validado, esta seção demonstra sua aplicação prática para prever a produção de energia em novos cenários hipotéticos. Foram criados dois exemplos para ilustrar a capacidade preditiva do modelo: uma usina Eólica de médio porte e uma usina Solar de grande porte com rastreador.

## **6.1. Predições com o Modelo Final**

```{r}
dados$tecnologia <- as.factor(dados$tecnologia)
dados$rastreador_solar <- as.factor(dados$rastreador_solar)

nomes_das_variaveis <- names(dados)
variavel_resposta <- "`Produção_energia_MWh_ano`"
variavel_a_remover <- "investimento_R$mi"
lista_de_preditores <- nomes_das_variaveis[!nomes_das_variaveis %in% c("Produção_energia_MWh_ano", variavel_a_remover)]
preditores_formatados <- paste0("`", lista_de_preditores, "`", collapse = " + ")
formula_em_texto <- paste(variavel_resposta, "~", preditores_formatados)
formula_final_segura <- as.formula(formula_em_texto)

modelo_final <- lm(formula_final_segura, data = dados)

# Criando cenários de predição
novos_cenarios <- data.frame(
  capacidade_instalada_MW = c(50, 150),
  fator_capacidade_pct = c(35, 25),
  disponibilidade_pct = c(95, 98),
  irradiancia_kWh_m2_dia = c(0, 5.5),
  vento_m_s = c(8.5, 0),
  distancia_rede_km = c(20, 10),
  idade_projeto_anos = c(5, 2),
  tecnologia = factor(c("Eólica", "Solar"), levels = levels(dados$tecnologia)),
  rastreador_solar = factor(c("Não", "Sim"), levels = levels(dados$rastreador_solar))
)

# Realiza a predição
predicao_predicao <- predict(modelo_final, newdata = novos_cenarios, interval = "prediction")

resultados_finais <- cbind(
  Cenario = c("Usina Eólica Média", "Usina Solar Grande"),
  novos_cenarios,
  Producao_Prevista = predicao_predicao[,1],
  Limite_Inferior_Pred = predicao_predicao[,2],
  Limite_Superior_Pred = predicao_predicao[,3]
)

library(kableExtra)
kable(resultados_finais, digits = 0, caption = "Previsões de Produção de Energia para Novos Cenários") %>%
  kable_styling(bootstrap_options = "striped", full_width = FALSE) %>%
  scroll_box(width = "100%")
```

Em seguida, encontraremos as estimações pontuais e intervalares (de confiança e de predição) para a variável resposta com base em dois conjuntos diferentes de preditores. Para ambos os casos, foram utilizados valores próximos à média das variáveis de base.

## 6.2. **Interpretação das Predições**

Utilizamos o modelo final validado para encontrar as estimações pontuais e intervalares (de confiança e predição) para a variável resposta. Foram criados dois cenários distintos e realistas para demonstrar a capacidade preditiva do modelo: uma usina eólica de médio porte e uma usina solar de grande porte.

```{r}
predicao_confianca <- predict(modelo_final, newdata = novos_cenarios, interval = "confidence")
print(predicao_confianca)
```

### 6.2.1. Análise do Intervalo de Confiança

-   Para o cenário de uma usina eólica de médio porte, é esperado que a produção média de todos os projetos com essas características seja de 136,248 MWh/ano. O intervalo de confiança de 95% para esta média indica que o verdadeiro valor médio para todos os projetos deste perfil estaria contido na faixa entre 133,255 e 139,241 MWh/ano.

-   Para o cenário de uma usina solar de grande porte com rastreador, a produção média esperada é de 389,217 MWh/ano. O intervalo de confiança de 95% para a média de projetos com este perfil está situado entre 387,018 e 391,415 MWh/ano.

### 6.2.2. Análise do Intervalo de Predição

-   Para uma única e nova usina eólica de médio porte, a estimativa pontual da produção é de 136,248 MWh/ano. O intervalo de predição de 95%, que é mais amplo por considerar a variabilidade de um projeto individual, indica que a produção deste novo projeto específico se encontrará entre 127,612 e 144,883 MWh/ano, com 95% de confiança.

-   Para uma única e nova usina solar de grande porte, a produção prevista é de 389,216 MWh/ano, com um intervalo de predição de 95% entre 380,823 e 397,610 MWh/ano. Este intervalo representa a faixa de valores que uma nova observação individual com esse perfil pode assumir e é a estimativa mais realista para a análise de viabilidade de um novo projeto.

# 7. Conclusão

O modelo inicial, que incluía todas as variáveis preditoras, revelou um forte problema de multicolinearidade entre `capacidade_instalada_MW` e `investimento_R$mi`, confirmado por uma correlação de 0.95 e altos valores de VIF. Para resolver essa questão, a seleção do modelo foi guiada pelo princípio da parcimônia e por múltiplas métricas. A comparação entre dois modelos reduzidos mostrou que o modelo sem `investimento_R$mi` era superior em termos de R² Ajustado, AIC e BIC. Adicionalmente, um teste ANOVA foi realizado, e embora seu p-valor tenha sido estatisticamente significativo, optou-se pelo modelo mais simples. Isso se deve ao fato de que, em cenários de multicolinearidade severa, a significância do ANOVA pode refletir um ganho de informação muito pequeno e de pouca relevância prática, sendo mais prudente priorizar a estabilidade e interpretabilidade dos coeficientes.

A verificação dos pressupostos do modelo de regressão linear múltipla foi então realizada sobre este modelo final. A análise de diagnóstico confirmou que os pressupostos de linearidade, homocedasticidade e normalidade dos resíduos foram satisfatoriamente atendidos. Testes adicionais para multicolinearidade residual e a análise de observações influentes reforçaram que o modelo está adequadamente ajustado, sendo considerado válido e confiável para ser utilizado em previsões.

Para testar a capacidade preditiva do modelo, foram criados dois cenários realistas: um "Projeto Solar Típico" e um "Projeto Eólico de Alta Performance". O modelo foi capaz de gerar estimativas pontuais e intervalares coerentes para a produção de energia, prevendo aproximadamente 171,114 MWh/ano para o projeto solar e 258,229 MWh/ano para o eólico. Os intervalos de predição, com 95% de confiança, indicaram uma faixa razoável de variação, demonstrando a utilidade do modelo para estimar a produção de novos projetos com boa confiabilidade.

Em conclusão, o modelo final demonstrou que a `capacidade_instalada_MW`é o fator esmagadoramente dominante na determinação da produção de energia. Fatores secundários, mas também estatisticamente significativos, incluem a `distancia_rede_km`, que impacta negativamente a produção (provavelmente por perdas de transmissão), e o uso de `rastreador_solar`, que a impacta positivamente. Um insight relevante da análise foi que, após controlar por esses fatores, variáveis como o tipo de `tecnologia` e o `fator_capacidade_pct` não se mostraram significativas, sugerindo que seu efeito já está, em grande parte, embutido na capacidade instalada do projeto.

Embora o modelo apresente boa aderência aos dados, seria interessante que estudos futuros investigassem possíveis interações entre variáveis e considerassem abordagens não lineares (modelos não lineares). Ainda assim, esta análise fornece análises valiosas para a otimização de sistemas de energia renovável, contribuindo para decisões mais embasadas no setor.
